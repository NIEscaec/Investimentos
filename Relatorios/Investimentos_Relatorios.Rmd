---
title: "Investimentos Brasil -  "
author:
- "Secretaria de Comércio Exterior e Assuntos Econômicos(SCAEC)"
- "Núcleo de Inteligência Econômica(NIE)"
- "Dados: Banco Central do Brasil"

date: " `r format(Sys.time(), '%d/%m/%Y')` "
output:
  pdf_document:
    latex_engine: lualatex
    toc: TRUE
    toc_depth: 3 
    number_sections: TRUE
organization:
toc-title: Índice
header-includes:
- \usepackage{fancyhdr}
- \usepackage{lscape}
- \usepackage{pdflscape}
- \usepackage{fancyhdr}
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{graphicx}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage[normalem]{ulem}
- \usepackage{xcolor}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
- \pagestyle{fancy}
- \fancyhead{}
- \fancyhead[CO,CE]{Brasil - , Dados de Investimentos}
- \fancyfoot[CO,CE]{}
- \fancyfoot[LE,RO]{\thepage}
tables: yes
graphics: yes
---

```{r, echo=FALSE, message=FALSE, warning = FALSE}
library(tidyverse)
library(tinytex)
library(rbcb)
library(DT)
library(tidyr)
library(dplyr)
library(stringr)
library(zoo)
library(ggplot2)
library(RColorBrewer)
library(qpdf)
library(kableExtra)
library(ggthemes)
library(ggrepel)
library(readxl)
library(tools)
library(shades)
library(shiny)

#Se não tiver o pacote baixado baixe aqui 
#devtools::install_github("NIEscaec/Investimentos")
library(Investimentos)
``` 




```{r, echo=FALSE, message=FALSE, warning = FALSE}
 pais_titulo <- "Angola"
```

---
title: "Investimentos Brasil - `r pais_titulo`"
--- 

```{r, echo=FALSE, message=FALSE, warning = FALSE}

  pais <- c("Angola")

```



```{r, echo=FALSE, message=FALSE, warning = FALSE, include=FALSE}

#----------------------------------------------------------- Puxa as tabelas do excel ---------------------------------------------
# Baixa a Planilha

httr::GET("https://www.bcb.gov.br/content/estatisticas/Documents/Tabelas_especiais/TabelasCompletasPosicaoIDP.xlsx",
          config = httr::config(ssl_verifypeer = F),
          httr::write_disk(here::here("data-raw", "TabelasCompletasPosicaoIDP.xlsx"), overwrite = T))



# Carrega a página 5 da Planilha IDP
Invest_Imediato_IDP <- ler_excel("data-raw/TabelasCompletasPosicaoIDP.xlsx", "5", 4)



# Carrega a página 6 da Planilha IDP
Control_Final_IDP <- ler_excel("data-raw/TabelasCompletasPosicaoIDP.xlsx", "6", 4)



# Carrega a página 7 da Planilha IDP
Oper_Intercomp_IDP <- ler_excel("data-raw/TabelasCompletasPosicaoIDP.xlsx", "7", 4)



# Carrega a página IDP ingresso por país da planilha Estrp
fluxo_Invest_InvEstrp <- ler_excel("data-raw/InvEstrp.xls","IDP ingresso por país", 4)



# Carrega a página Igressos por país da Planilha InterciaPassivo
Igressos_InterciaPassivo <- ler_excel("data-raw/InterciaPassivop.xls", "Ingressos por país", 4)



# Carrega a página Amortizações por país da Planilha InterciaPassivo
Amortizacoes_InterciaPassivo <- ler_excel("data-raw/InterciaPassivop.xls", "Amortizações por país", 4)




# Lista com os anos
anos <- c("2010", "2011", "2012", "2013", "2014", "2015",
          "2016", "2017", "2018", "2019", "2020")



# Carrega as linhas 1 a 6 da tabela 1
Invest_Imediato_IDP <- ler_linha(Invest_Imediato_IDP,12)
Control_Final_IDP <- ler_linha(Control_Final_IDP,12)
Oper_Intercomp_IDP <- ler_linha(Oper_Intercomp_IDP,12)
fluxo_Invest_InvEstrp <- ler_linha(fluxo_Invest_InvEstrp,12)
Igressos_InterciaPassivo <- ler_linha(Igressos_InterciaPassivo,12)
Amortizacoes_InterciaPassivo <- ler_linha(Amortizacoes_InterciaPassivo,12)



# realiza soma das linhas dos países e o pivot
Invest_Imediato_IDP <- soma_linhas(Invest_Imediato_IDP)
Control_Final_IDP <- soma_linhas(Control_Final_IDP)
Oper_Intercomp_IDP <- soma_linhas(Oper_Intercomp_IDP)
fluxo_Invest_InvEstrp <- soma_linhas(fluxo_Invest_InvEstrp)
Igressos_InterciaPassivo <- soma_linhas(Igressos_InterciaPassivo)
Amortizacoes_InterciaPassivo <- soma_linhas(Amortizacoes_InterciaPassivo)
fluxo_liq_IDP <- Igressos_InterciaPassivo - Amortizacoes_InterciaPassivo

#---------------------------------------------------------------------------------------------------------------------------------
#                                                            Parte 2
#---------------------------------------------------------------------------------------------------------------------------------

httr::GET("https://www.bcb.gov.br/content/estatisticas/Documents/Tabelas_especiais/TabelasCompletasPosicaoIDE.xlsx",
          config = httr::config(ssl_verifypeer = F),
          httr::write_disk(here::here("data-raw", "TabelasCompletasPosicaoIDE.xlsx"), overwrite = T))




# Carrega a página 3 da Planilha IDE
Invest_Imediato_IDE <- ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx", "3", 4)



# Carrega a página 9 da Planilha IDP
Oper_Intercomp_IDE <- ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx", "9", 4)



# Carrega a página 11 da Planilha IDP
Acoes_IDE <- ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx", "11", 4)



# Carrega a página 13 da Planilha IDP
RF_Longo_Prazo_IDE <- ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx", "13", 4)



# Carrega a página 12 da Planilha IDP
RF_Curto_Prazo_IDE <- ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx", "12", 4)



# Carrega a página 14 da Planilha IDP
Moedas_19_IDE <-ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx", "14", 4)



# Carrega a página 15 da Planilha IDP
Moedas_20_IDE <- ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx", "15", 4)



# Carrega a página 16 da Planilha IDP
Imoveis_19_IDE <- ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx","16",4)



# Carrega a página 17 da Planilha IDP
Imoveis_20_IDE <- ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx", "17", 4)



# Carrega a página IDE saídas por país da Planilha InvBrap
Fluxo_Invest_Imediatop_IDE <- ler_excel("data-raw/InvBrap.xls", "IDE saídas por país", 4)




moedas <- full_join(Moedas_19_IDE, Moedas_20_IDE, by = c("Discriminação"))
moedas <- select(moedas,Discriminação, anos)



imoveis <- full_join(Imoveis_19_IDE, Imoveis_20_IDE, by = c("Discriminação"))
imoveis <- select(imoveis,Discriminação, anos)




# Carrega as linhas 1 a 9 da tabela 2
Invest_Imediato_IDE <- ler_linha(Invest_Imediato_IDE,12)
Oper_Intercomp_IDE <- ler_linha(Oper_Intercomp_IDE,12)
Acoes_IDE <- ler_linha(Acoes_IDE,12)
RF_Longo_Prazo_IDE <- ler_linha(RF_Longo_Prazo_IDE,12)
RF_Curto_Prazo_IDE <- ler_linha(RF_Curto_Prazo_IDE,12)
moedas <- ler_linha(moedas,12)
imoveis <- ler_linha(imoveis,12)
Fluxo_Invest_Imediatop_IDE <- ler_linha(Fluxo_Invest_Imediatop_IDE,12)



# realiza soma das linhas dos países e o pivot
Invest_Imediato_IDE <- soma_linhas(Invest_Imediato_IDE)
Oper_Intercomp_IDE <- soma_linhas(Oper_Intercomp_IDE)
Acoes_IDE <- soma_linhas(Acoes_IDE)
RF_Longo_Prazo_IDE <- soma_linhas(RF_Longo_Prazo_IDE)
RF_Curto_Prazo_IDE <- soma_linhas(RF_Curto_Prazo_IDE)
moedas <- soma_linhas(moedas)
imoveis <- soma_linhas(imoveis)
Fluxo_Invest_Imediatop_IDE <- soma_linhas(Fluxo_Invest_Imediatop_IDE)
PG_IDE_invest_carteira <- Acoes_IDE + RF_Longo_Prazo_IDE + RF_Curto_Prazo_IDE

```















\newpage
# Investimentos do(a) `r pais_titulo` no Brasil
```{r, message=FALSE, echo=FALSE, warning = FALSE}
# ------------------------------------------------------ Cod Tabela1 ----------------------------------------------------------

# junta as linhas em uma só tabela
tabela1_plan1 <- bind_rows(Control_Final_IDP,Oper_Intercomp_IDP,Invest_Imediato_IDP,fluxo_Invest_InvEstrp,fluxo_liq_IDP)


setores_tab1 <- c("IDP-Participação no Capital(Control. Final)",
                  "IDP-Operações Intercompanhia",
                  "IDP-Participação no Capital(Invest.Imed)",
                  "Fluxo-Participação no Capital(Invest.Imed)",
                  "Fluxo Líquido-Operações Intercompanhia")


tabela1_plan1 <- criar_tabela(tabela1_plan1, setores_tab1)


# Divide a tabla em 2
tabela1_plan1.1 <- tabela1_plan1 %>% select(names, "2010", "2011", "2012", "2013", "2014", "2015")
tabela1_plan1.2 <- tabela1_plan1 %>% select(names, "2016", "2017", "2018", "2019", "2020")
```


```{r,echo=FALSE,menssage=FALSE,warning = FALSE, fig.width=8.5, fig.height=4.5, out.width = "100%"}
# ------------------------------------ * Grafico 1 * ------------------------------------ 

#------------------------------------------------------------------------------------------------------------------ 
 tab_grafico1 <- tabela1_plan1 
#------------------------------------------------------------------------------------------------------------------ 
 tab_grafico1 <- tab_grafico1 %>% 
   select(names,"2010","2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")%>%
   pivot_longer(cols = "2010":"2020", names_to = "anos", values_to = "setores") 
#------------------------------------------------------------------------------------------------------------------ 
 
 a <- tab_grafico1 %>%
   filter("IDP-Participação no Capital(Control. Final)" == names)
 
 b <- tab_grafico1 %>%
   filter("IDP-Operações Intercompanhia" == names)
 
 c <- tab_grafico1 %>%
   filter("IDP-Participação no Capital(Invest.Imed)" == names)
 
#------------------------------------------------------------------------------------------------------------------  
 d <- tab_grafico1 %>%
   filter("Fluxo-Participação no Capital(Invest.Imed)" == names)
 
 e <- tab_grafico1 %>%
   filter("Fluxo Líquido-Operações Intercompanhia" == names)
 
# ------------------------------------------------------------------------------------------------------------------ 
  qanos <- nrow(a)
if(a$setores > 0 || b$setores > 0 || c$setores > 0 || d$setores > 0 || e$setores > 0){
  ggplot(a, aes(x = anos, y = setores), 
         b, aes(x = anos, y = setores), 
         c, aes(x = anos, y = setores), 
         d, aes(y = setores),
         e, aes(y = setores))+
          geom_bar( stat = "identity", aes(x = a$anos, y = a$setores, fill = "IDP - Participação no Capital (Controlador Final)"), 
                     position = position_nudge(x = -.20), width = .2)+
    
          geom_bar( stat = "identity", aes(x = b$anos, y = b$setores, fill = "IDP - Operações Intercompanhia"), 
                       position = position_nudge(x = -0), width = .2)+
    
          geom_bar(stat = "identity", aes(x = c$anos, y = c$setores, fill = "IDP - Participação no Capital (Invest. Imediato)"), 
                      position = position_nudge(x = .20), width = .2)+
    
          geom_line(aes(y = d$setores*3, group = " ", color = "Fluxo - Participação no Capital (Invest. Imediato)"), 
                    size = 1.1, linetype = 1)+
    
          geom_line(aes(y = e$setores*3, group = " ", color = "Fluxo Líquido - Operações Intercompanhia"), 
                    size = 1.1, linetype = 1)+
    
          geom_line(aes(y = -1, group = " " ),
                    size = 1, linetype = 2)+
   
          scale_y_continuous("US$ milhões", sec.axis = sec_axis(~ . /3 ))+
          scale_x_yearmon(NULL, format = "%Y", n = qanos)+
          scale_color_manual(NULL, values =  saturation(c("#B22222","#8A2BE2","#252A52","#FFC465","#66ADE5"), scalefac(0.8)))+
          scale_fill_manual(NULL, values = saturation(c("#252A52","#FFC465","#66ADE5","#B22222","#8A2BE2"), scalefac(0.8)))+
    
          theme_classic ()+
          theme(panel.grid = element_blank(), # remove as linhas do corpo do gráfico
          # sem bordas entre os painéis
          panel.spacing = unit(0, "cm"),
          # modifica o texto dos eixos
          axis.text = element_text(size = 12, colour = "black"),
          # cor dos marcadores
          axis.ticks = element_line(colour = "black"),
          # tamanho dos marcadores
          axis.ticks.length = unit(.2, "cm"),
          #cor da borda
          panel.border = element_rect(colour = "black", fill = NA, size = 0.5),
          axis.text.x = element_text(angle = 0, hjust = 0.5),
          legend.position="bottom", legend.box = "vertical")

}else{
  print("Sem dados suficientes para gerar o gráfico!")
}
 
```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}
# ------------------------------------ * Tabela 1 planilha 1 * ------------------------------------ 

  kableExtra::kable(tabela1_plan1.1,digits = 2, format = "markdown", align = 'llllccccccc')

```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}
# ------------------------------------ * Tabela 1 planilha 1 * ------------------------------------ 

 kableExtra::kable(tabela1_plan1.2,digits = 2, format = "markdown", align = 'llllcccccc')

```











\newpage
```{r, echo=FALSE, message=FALSE,warning = FALSE, message=FALSE, highlight=FALSE}
  #====================================================================== COD Tabela 2==========================================================================
  #                                                                 Coluna Control. Final
  #=============================================================================================================================================================

                                                                    # ANO 2020
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2020_CF <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "14", range = "A5:AJ20")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  linhas <- c(1, 2, 3, 7, 10, 11, 13, 15)
  ANO_2020_CF <- ANO_2020_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2020_CF <- ANO_2020_CF %>% mutate(dplyr::across(.cols=2:36, .fns=as.numeric))
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2020_CF <- ANO_2020_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:Indonésia,
      names_to = "pais",
      values_to = "valor")
#====================================================================================================================================================================

                                                                          # ANO 2019
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2019_CF <-  read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "14", range = "A27:AJ42")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2019_CF <- ANO_2019_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2019_CF <- ANO_2019_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:`Emirados Árabes Unidos`,
      names_to = "pais",
      values_to = "valor")
#=============================================================================================================================================================

                                                                           # ANO 2018
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2018_CF <-  read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "14", range = "A48:AJ63")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2018_CF <- ANO_2018_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2018_CF <- ANO_2018_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:Dinamarca,
      names_to = "pais",
      values_to = "valor")
#====================================================================================================================================================================

                                                                         # ANO 2017
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2017_CF <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "14", range = "A70:AJ85")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2017_CF <- ANO_2017_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2017_CF <- ANO_2017_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:Finlândia,
      names_to = "pais",
      values_to = "valor")
#====================================================================================================================================================================
 
   #                                                                         ANO 2016
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2016_CF <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "14", range = "A92:AJ107")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2016_CF <- ANO_2016_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2016_CF <- ANO_2016_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:Israel,
      names_to = "pais",
      values_to = "valor")
#====================================================================================================================================================================
  
  #                                                                         ANO 2015
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2015_CF <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "14", range = "A112:AJ127")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2015_CF <- ANO_2015_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2015_CF <- ANO_2015_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:Áustria,
      names_to = "pais",
      values_to = "valor")
#===================================================================================================================================================================


  #                                                                         ANO 2014
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2014_CF <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "14", range = "A132:AJ147")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2014_CF <- ANO_2014_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2014_CF <- ANO_2014_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:Colômbia,
      names_to = "pais",
      values_to = "valor")
#===================================================================================================================================================================


  #                                                                         ANO 2013
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2013_CF <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "14", range = "A152:AJ167")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2013_CF <- ANO_2013_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2013_CF <- ANO_2013_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:`África do Sul`,
      names_to = "pais",
      values_to = "valor")
#===================================================================================================================================================================

  #                                                                         ANO 2012
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2012_CF <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx", sheet = "14", range = "A172:AJ187")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2012_CF <- ANO_2012_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2012_CF <- ANO_2012_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:"Bahamas",
      names_to = "pais",
      values_to = "valor")
#===================================================================================================================================================================
 
  #                                                                         ANO 2011
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2011_CF <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx", sheet = "14", range = "A192:AJ207")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2011_CF <- ANO_2011_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2011_CF <- ANO_2011_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:`Ilha de Man`,
      names_to = "pais",
      values_to = "valor")
  #===================================================================================================================================================================
 
  #                                                                         ANO 2010
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2010_CF <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "14", range = "A212:AJ227")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2010_CF <- ANO_2010_CF[-linhas, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  ANO_2010_CF <- ANO_2010_CF %>%
    pivot_longer(
      cols = `Estados Unidos`:"Angola",
      names_to = "pais",
      values_to = "valor")
  #===================================================================================================================================================================
  # Adiciona a coluna anos
  ANO_2010_CF$Ano <- "2010"
  ANO_2010_CF$Ano <- as.numeric(ANO_2010_CF$Ano)

  ANO_2011_CF$Ano <- "2011"
  ANO_2011_CF$Ano <- as.numeric(ANO_2011_CF$Ano)

  ANO_2012_CF$Ano <- "2012"
  ANO_2012_CF$Ano <- as.numeric(ANO_2012_CF$Ano)

  ANO_2013_CF$Ano <- "2013"
  ANO_2013_CF$Ano <- as.numeric(ANO_2013_CF$Ano)

  ANO_2014_CF$Ano <- "2014"
  ANO_2014_CF$Ano <- as.numeric(ANO_2014_CF$Ano)

  ANO_2015_CF$Ano <- "2015"
  ANO_2015_CF$Ano <- as.numeric(ANO_2015_CF$Ano)

  ANO_2016_CF$Ano <- "2016"
  ANO_2016_CF$Ano <- as.numeric(ANO_2016_CF$Ano)

  ANO_2017_CF$Ano <- "2017"
  ANO_2017_CF$Ano <- as.numeric(ANO_2017_CF$Ano)

  ANO_2018_CF$Ano <- "2018"
  ANO_2018_CF$Ano <- as.numeric(ANO_2018_CF$Ano)

  ANO_2019_CF$Ano <- "2019"
  ANO_2019_CF$Ano <- as.numeric(ANO_2019_CF$Ano)

  ANO_2020_CF$Ano <- "2020"
  ANO_2020_CF$Ano <- as.numeric(ANO_2020_CF$Ano)
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # renomeia a coluna setor
  ANO_2010_CF <- ANO_2010_CF %>%
    rename("Setores" = `ANO: 2010`)

  ANO_2011_CF <- ANO_2011_CF %>%
    rename("Setores" = `ANO: 2011`)

  ANO_2012_CF <- ANO_2012_CF %>%
    rename("Setores" = `ANO: 2012`)

  ANO_2013_CF <- ANO_2013_CF %>%
    rename("Setores" = `ANO: 2013`)

  ANO_2014_CF <- ANO_2014_CF %>%
    rename("Setores" = `ANO: 2014`)

  ANO_2015_CF <- ANO_2015_CF %>%
    rename("Setores" = `ANO: 2015`)

  ANO_2016_CF <- ANO_2016_CF %>%
    rename("Setores" = `ANO: 2016`)

  ANO_2017_CF <- ANO_2017_CF %>%
    rename("Setores" = `ANO: 2017`)

  ANO_2018_CF <- ANO_2018_CF %>%
    rename("Setores" = `ANO: 2018`)

  ANO_2019_CF <- ANO_2019_CF %>%
    rename("Setores" = `ANO: 2019`)

  ANO_2020_CF <- ANO_2020_CF %>%
    rename("Setores" = `ANO: 2020`)
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # junat em data frame só
  IDP_Por_Setor_Control_Final <- bind_rows(ANO_2020_CF, ANO_2019_CF, ANO_2018_CF, ANO_2017_CF, ANO_2016_CF, ANO_2015_CF, ANO_2014_CF, 
                                           ANO_2013_CF, ANO_2012_CF, ANO_2011_CF, ANO_2010_CF)
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # variavel para filtra o pais
  pais_filtro <- pais
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # gera o a tabela control_final
  IDP_Por_Setor_Control_Final <- IDP_Por_Setor_Control_Final %>%
    filter(IDP_Por_Setor_Control_Final$pais %in% pais_filtro)
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # (Aui a magica acontece) filtra o ano mais atual
  IDP_Por_Setor_Control_Final <- IDP_Por_Setor_Control_Final %>%
    filter(Ano %in% max(Ano))
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # Seleciona as colunas necessarias
  IDP_Por_Setor_Control_Final <- IDP_Por_Setor_Control_Final %>%
    select(Setores, valor, Ano)
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # excluia a linha desnecessaria
  linha <- c(7)
  IDP_Por_Setor_Control_Final <- IDP_Por_Setor_Control_Final[-linha, ]
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # transforma NA em 0
  IDP_Por_Setor_Control_Final[is.na(IDP_Por_Setor_Control_Final)] <- 0
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # Faz o calculo da linha outros e adiciona no data frame
  outros_Control_Final <- outros_func(IDP_Por_Setor_Control_Final, Control_Final_IDP)
  
  outros_Control_Final <- mutate(outros_Control_Final, IDP_Por_Setor_Control_Final$Ano[1])
  
  IDP_Por_Setor_Control_Final[nrow(IDP_Por_Setor_Control_Final) + 1,] <- outros_Control_Final
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  
  ano_IDP <- max(IDP_Por_Setor_Control_Final$Ano)
```


```{r, echo=FALSE, message=FALSE,warning = FALSE, message=FALSE, highlight=FALSE}
  #====================================================================== COD Tabela 2==========================================================================
  #                                                                 Coluna Invest. Imed
  #=============================================================================================================================================================


  IDP_func <- function(dataframe, ano, coluna){
    dataframe$Ano <- ano
    dataframe$Ano <- as.numeric(dataframe$Ano)
  
   dataframe %>%
      rename("Setores" = coluna)}
  
  pivot_longer_ano <- function(dataframe, pais1, pais2){
    dataframe %>%
      pivot_longer(
        cols = pais1:pais2,
        names_to = "pais",
        values_to = "valor")}
  #--------------------------------------------------------------------------------------------------------------------------------------------------------------

  ANO_2010_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A213:AJ226")
  
  ANO_2011_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A193:AJ206")
  
  ANO_2012_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A173:AJ186")
  
  ANO_2013_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A153:AJ166")
  
  ANO_2014_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A133:AJ146")
  
  ANO_2015_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A113:AJ126")
  
  ANO_2016_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A93:AJ106")
  
  ANO_2017_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A71:AJ84")
  
  ANO_2018_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A49:AJ62")
  
  ANO_2019_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A27:AJ40")
  
  ANO_2020_INV <- read_xlsx("data-raw/TabelasCompletasPosicaoIDP.xlsx",sheet = "13", range = "A5:AJ18")
  ANO_2020_INV <- turn_numeric(ANO_2020_INV, 36)
  #############################################################################################################################################################
  
  ANO_2010_INV <- ANO_2010_INV[-linhas, ]
  ANO_2010_INV <- pivot_longer_ano(ANO_2010_INV,"Países Baixos", "Curaçao")
  ANO_2010_INV <- IDP_func(ANO_2010_INV, "2010", "ANO: 2010")
  ##############################################################################################################################################################
  
  ANO_2011_INV <- ANO_2011_INV[-linhas, ]
  ANO_2011_INV <- pivot_longer_ano(ANO_2011_INV,"Países Baixos", "Barbados")
  ANO_2011_INV <- IDP_func(ANO_2011_INV, "2011", "ANO: 2011")
  ##############################################################################################################################################################

  ANO_2012_INV <- ANO_2012_INV[-linhas, ]
  ANO_2012_INV <- pivot_longer_ano(ANO_2012_INV,"Países Baixos", "Colômbia")
  ANO_2012_INV <- IDP_func(ANO_2012_INV, "2012", "ANO: 2012")
  ##############################################################################################################################################################
  
  ANO_2013_INV <- ANO_2013_INV[-linhas, ]
  ANO_2013_INV <- pivot_longer_ano(ANO_2013_INV,"Países Baixos", "Angola")
  ANO_2013_INV <- IDP_func(ANO_2013_INV, "2013", "ANO: 2013")
  ##############################################################################################################################################################
  
  ANO_2014_INV <- ANO_2014_INV[-linhas, ]
  ANO_2014_INV <- pivot_longer_ano(ANO_2014_INV,"Países Baixos", "Angola")
  ANO_2014_INV <- IDP_func(ANO_2014_INV, "2014", "ANO: 2014")
  ##############################################################################################################################################################
  
  ANO_2015_INV <- ANO_2015_INV[-linhas, ]
  ANO_2015_INV <- pivot_longer_ano(ANO_2015_INV,"Países Baixos", "Curaçao")
  ANO_2015_INV <- IDP_func(ANO_2015_INV, "2015", "ANO: 2015")
  ##############################################################################################################################################################
  
  ANO_2016_INV <- ANO_2016_INV[-linhas, ]
  ANO_2016_INV <- pivot_longer_ano(ANO_2016_INV,"Países Baixos", "Hong Kong")
  ANO_2016_INV <- IDP_func(ANO_2016_INV, "2016", "ANO: 2016")
  ##############################################################################################################################################################
  
  ANO_2017_INV <- ANO_2017_INV[-linhas, ]
  ANO_2017_INV <- pivot_longer_ano(ANO_2017_INV,"Países Baixos", "Finlândia")
  ANO_2017_INV <- IDP_func(ANO_2017_INV, "2017", "ANO: 2017")
  ##############################################################################################################################################################
  
  ANO_2018_INV <- ANO_2018_INV[-linhas, ]
  ANO_2018_INV <- pivot_longer_ano(ANO_2018_INV,"Países Baixos", "Emirados Árabes Unidos")
  ANO_2018_INV <- IDP_func(ANO_2018_INV, "2018", "ANO: 2018")
  ##############################################################################################################################################################
  
  ANO_2019_INV <- ANO_2019_INV[-linhas, ]
  ANO_2019_INV <- pivot_longer_ano(ANO_2019_INV,"Países Baixos", "Hong Kong")
  ANO_2019_INV <- IDP_func(ANO_2019_INV, "2019", "ANO: 2019")
  ##############################################################################################################################################################
  
  ANO_2020_INV <- ANO_2020_INV[-linhas, ]
  ANO_2020_INV <- pivot_longer_ano(ANO_2020_INV,"Países Baixos", "Finlândia")
  ANO_2020_INV <- IDP_func(ANO_2020_INV, "2020", "ANO: 2020")
  ##############################################################################################################################################################
  

  IDP_Por_Setor_Inv_Imed <- bind_rows(ANO_2010_INV, ANO_2011_INV, ANO_2012_INV, ANO_2013_INV, ANO_2014_INV, ANO_2015_INV, ANO_2016_INV,
                                      ANO_2017_INV, ANO_2018_INV, ANO_2019_INV, ANO_2020_INV)
  IDP_Por_Setor_Inv_Imed <- IDP_Por_Setor_Inv_Imed %>%
    rename(Pais = pais)
  
  
  IDP_Por_Setor_Inv_Imed <- IDP_Por_Setor_Inv_Imed %>%
       filter(IDP_Por_Setor_Inv_Imed$Pais %in% pais)
  IDP_Por_Setor_Inv_Imed <- IDP_Por_Setor_Inv_Imed %>%
       filter(Ano %in% max(Ano))
  IDP_Por_Setor_Inv_Imed <- IDP_Por_Setor_Inv_Imed %>%
      select(Setores, valor, Ano)
  
  outros_Inv_Imed <- outros_func(IDP_Por_Setor_Inv_Imed, Invest_Imediato_IDP)
  outros_Inv_Imed <- mutate(outros_Inv_Imed, IDP_Por_Setor_Inv_Imed$Ano[1])
  IDP_Por_Setor_Inv_Imed[nrow(IDP_Por_Setor_Inv_Imed) + 1,] <- outros_Inv_Imed
```


```{r, echo=FALSE, message=FALSE,warning = FALSE, message=FALSE, highlight=FALSE}
  #Junta control_final e invest_imed
  IDP_Por_Setor_Inv_Imed <- IDP_Por_Setor_Inv_Imed %>%
  select(Setores, valor)
    
  IDP_Por_Setor_Control_Final <- IDP_Por_Setor_Control_Final %>%
  select(Setores, valor)

  tabela_por_setor <-left_join(IDP_Por_Setor_Inv_Imed, IDP_Por_Setor_Control_Final,by="Setores",suffix = c(".Invest Imediato",".Control Final"))
  
 #-----------------------------------------------------------------------------------------------------------------------------------------------------------
  # ajusta o nome dos setores
  tabela_por_setor$Setores <- c("Indústrias Extrativas",
                        "Indústrias de Transformação",
                        "Eletricidade e Gás",
                        "Comércio, Reparação de Veículos Automotores e Motocicletas",
                        "Transporte, Armazenagem e Correio",
                        "Atividades Financeiras, de Seguros e Serviços Relacionados",
                        "Outros")
  #-----------------------------------------------------------------------------------------------------------------------------------------------------------
    
  #Renomeia o nome da coluna setores
  tabela_por_setor <- rename(tabela_por_setor, "Setor de atividade econômica (Estoque 2020 - US$ milhões)" = Setores)
```


#  Setor de Atividade Econômica (Estoque `r ano_IDP` - US$ milhões)
```{r,echo=FALSE,menssage=FALSE,warning = FALSE, fig.width=8.5, fig.height=4.5, out.width = "100%"}
# ------------------------------------ * Grafico 2 * ------------------------------------ 

  
  #Criar uma nova tabela igual a de setor para trabalhar no grafico
  tab_grafico2 <- tabela_por_setor
#------------------------------------------------------------------------------------------------------------------
  
  #Renomeia as cokunas para ficar facil de trabalhar
  tab_grafico2 <- rename(tab_grafico2, "Setor" = "Setor de atividade econômica (Estoque 2020 - US$ milhões)")
  tab_grafico2 <- rename(tab_grafico2, "Control_Final" = "valor.Control Final")
  tab_grafico2 <- rename(tab_grafico2, "Invest_Imediato" = "valor.Invest Imediato")
#------------------------------------------------------------------------------------------------------------------ 
  
  #Realiza a soma do controle final
  total_control_final <- tab_grafico2 %>% 
      filter(tab_grafico2$Control_Final == max(tab_grafico2$Control_Final)) %>%
      select(-grep("Control_Final", colnames(tab_grafico2))) %>%
      summarise(var = colSums(tab_grafico2[3]))
#------------------------------------------------------------------------------------------------------------------ 
  
  #Separa a coluna controle final
  coluna_control_final <- tab_grafico2 %>%
    select(Control_Final)
#------------------------------------------------------------------------------------------------------------------ 
  
  #Calculo do porcentagem final
  tab_grafico2_porcentagem = coluna_control_final * 100 / total_control_final$var
#------------------------------------------------------------------------------------------------------------------ 
  
  #Add a porcentagem na tabela
  tab_grafico2$porcentagem <-  tab_grafico2_porcentagem$Control_Final
#------------------------------------------------------------------------------------------------------------------
  #Filtra somente dados maiores que 0 para gerar o grafico
  tab_grafico2 <- tab_grafico2 %>% filter(porcentagem >= 0.01)
  
#------------------------------------------------------------------------------------------------------------------
  #Cria o grafico
    ggplot(tab_grafico2, aes(x="", y = porcentagem, fill= Setor ),
           label = porcentagem )+
    geom_bar(stat = "identity")+
    coord_polar(theta = "y", start = 0)+
    theme_void()+
    geom_label_repel(label = paste(round(tab_grafico2$porcentagem ,2),"%"), show.legend = F, size = 5,
                     position =  position_stack(vjust = 0.5))

```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}

    kableExtra::kable(tabela_por_setor, digits = 2, format = "markdown", align = 'lccc')
```


```{r, echo=FALSE, message=FALSE,warning = FALSE}
#--------------------------------------------- IDP Quantidade de Investidores Tabela2 --------------------------------------------------

anos15e20 <- c("2015", "2020")

Quantidade_Control_Final  <- ler_excel("data-raw/TabelasCompletasPosicaoIDP.xlsx", "9", 4)

Quantidade_Control_Final <- IDP_Qtd_Invest(Quantidade_Control_Final, anos15e20)

Quantidade_Control_Final <- soma_Qtd_Invest(Quantidade_Control_Final,3 ,anos15e20)

Quantidade_Invest_Imediato <- ler_excel("data-raw/TabelasCompletasPosicaoIDP.xlsx", "8", 4) 

Quantidade_Invest_Imediato <- IDP_Qtd_Invest(Quantidade_Invest_Imediato, anos15e20)

Quantidade_Invest_Imediato <- soma_Qtd_Invest(Quantidade_Invest_Imediato,3 ,anos15e20)

Quantidade_Control_Final <- add_column(Quantidade_Control_Final, Setor = "Controlador Final", .before = 1)

Quantidade_Invest_Imediato <- add_column(Quantidade_Invest_Imediato, Setor = "Investimento Imediato", .before = 1)


#----------------------------------------------------------------------------------------------------------------------------
Qtd_Invest <- full_join(Quantidade_Invest_Imediato, Quantidade_Control_Final)
#----------------------------------------------------------------------------------------------------------------------------
```

                 IDP - Quantidade de Investidores (>= 10% capital acionário)
```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}

kableExtra::kable(Qtd_Invest, digits = 2, format = "markdown", align = 'lccc')
```











\newpage
#  Investimentos do Brasil no(a) `r pais_titulo`
```{r, echo=FALSE, message=FALSE, warning = FALSE}
# --------------------------------------------------- Tabela 3 ---------------------------------------------------
# Tabela IBD
tabela_IBD <- bind_rows(Invest_Imediato_IDE,Oper_Intercomp_IDE, Fluxo_Invest_Imediatop_IDE)

setor_tab2 <- c("IBD-Participação no Capital(Invest. Imed)",
                "IBD-Operações Intercompanhia",
                "Fluxo-Participação no Capital(Invest. Imed)")

tabela_IBD <- criar_tabela(tabela_IBD, setor_tab2)

# ------------------------------------------------------------------------------------------------------
# Divide a tabla em 2
tabela_IBD.1 <- tabela_IBD %>% select(names, "2010", "2011", "2012", "2013", "2014", "2015")
tabela_IBD.2 <- tabela_IBD %>% select(names, "2016", "2017", "2018", "2019", "2020")
```


```{r, echo=FALSE,fig.width=8.5, fig.height=4.5, message=FALSE, warning = FALSE, out.width = "100%"}
# ------------------------------------ * Grafico 3 * ------------------------------------ 
  tab_grafico3 <- tabela_IBD
  
  tab_grafico3 <- tab_grafico3 %>% 
    select(names,"2010","2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")%>%
    pivot_longer(cols = "2010":"2020", names_to = "anos", values_to = "setor") 
  #------------------------------------------------------------------------------------------------------------------ 
  
  a <- tab_grafico3 %>%
    filter("IBD-Participação no Capital(Invest. Imed)" == names)
  
  b <- tab_grafico3 %>%
    filter("IBD-Operações Intercompanhia" == names)
  
  c <- tab_grafico3 %>%
    filter("Fluxo-Participação no Capital(Invest. Imed)" == names)
  
  
  qanos<- nrow(tab_grafico3)
  
  if(a$setor > 0 || b$setor > 0 || c$setor > 0){
    ggplot(a, aes(x = anos, y = setor ),
           b, aes(y = setor ),
           c, aes(y = setor )
            ) +
      geom_bar(stat = "identity", aes(y = a$setor, fill = "IBD - Participação no Capital (Invest. Imediato)" ), 
               position = position_nudge(x = -.15), width = .3)+
      
      geom_bar(stat = "identity", aes(y = b$setor, fill = "IBD - Operações Intercompanhia"  ), 
               position = position_nudge(x = .15), width = .3)+
      
      geom_line(aes(y = c$setor*10,group = "",  colour = "Fluxo - Participação no Capital (Invest. Imeadiato)"), size = 1, linetype = 1) +
    
      scale_y_continuous("US$ milhões", sec.axis = sec_axis(~ . /10 ))+
      scale_x_yearmon(NULL, format = "%Y", breaks = seq(2010,2020))+
      scale_color_manual(NULL, values = saturation(c("#6959CD","#99b765","#5d83ad"), scalefac(0.8)))+
      scale_fill_manual(NULL, values = saturation(c("#99b765","#5d83ad","#6959CD"), scalefac(0.8)))+
      theme_classic ()+
      theme(panel.grid = element_blank(), # remove as linhas do corpo do gráfico
            # sem bordas entre os painéis
            panel.spacing = unit(0, "cm"),
            # modifica o texto dos eixos
            axis.text = element_text(size = 12, colour = "black"),
            # cor dos marcadores
            axis.ticks = element_line(colour = "black"),
            # tamanho dos marcadores
            axis.ticks.length = unit(.2, "cm"),
            #cor da borda
            panel.border = element_rect(colour = "black", fill = NA, size = 0.5),
            axis.text.x = element_text(angle = 0, hjust = 0.5),
            legend.position="bottom", legend.box = "vertical")
  }else{
    print("Sem dados suficientes para gerar o gráfico!")
  }
```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}

  kableExtra::kable(tabela_IBD.1, digits = 2, format = "markdown", align = 'lccccccc')
  
```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}

  kableExtra::kable(tabela_IBD.2, digits = 2, format = "markdown" , align = 'lccccccc')
  

```











\newpage
# Investimento em Carteira
```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}
# ----------------------------------------- * Cod tabela 4 * -------------------------------------------------
tabela_acoes <- Acoes_IDE

setor_tab2 <- c("Ações")

tabela_acoes <- criar_tabela(tabela_acoes, setor_tab2)
```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE, out.width = "100%"}
# ----------------------------------------- * Grafico 4 * -------------------------------------------------
  tab_grafico4 <- tabela_acoes
 

  if(tab_grafico4$`2010` > 0 || tab_grafico4$`2011` > 0 || tab_grafico4$`2012` > 0 || tab_grafico4$`2013` > 0 || tab_grafico4$`2014` > 0 ||
     tab_grafico4$`2015` > 0 || tab_grafico4$`2016` > 0 || tab_grafico4$`2017` > 0 || tab_grafico4$`2018` > 0 || tab_grafico4$`2019` > 0 ||
     tab_grafico4$`2020` > 0){
    
    tab_grafico4 <- tab_grafico4 %>% 
      select(names,"2010","2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")%>%
      pivot_longer(cols = "2010":"2020", names_to = "anos", values_to = "valores") 
    
      ggplot(tab_grafico4, aes(x = anos, y = valores)) +
        geom_bar(stat = "identity", aes(y = valores, fill = "Ações" ), width = .5)+
        scale_y_continuous("US$ milhões")+
        scale_x_yearmon(NULL, format = "%Y", breaks = seq(2010,2020))+
        scale_fill_manual(NULL, values = saturation(c("#252A52","#FFC465","#BF1B0B"), scalefac(0.8)))+
        theme_classic ()+
        theme(panel.grid = element_blank(), # remove as linhas do corpo do gráfico
              # sem bordas entre os painéis
              panel.spacing = unit(0, "cm"),
              # modifica o texto dos eixos
              axis.text = element_text(size = 12, colour = "black"),
              # cor dos marcadores
              axis.ticks = element_line(colour = "black"),
              # tamanho dos marcadores
              axis.ticks.length = unit(.2, "cm"), 
              #cor da borda
              panel.border = element_rect(colour = "black", fill = NA, size = 0.5),
              axis.text.x = element_text(angle = 0, hjust = 0.5),
              legend.position="bottom", legend.box = "vertical")   
  }else{
    print("Sem dados suficientes para gerar o gráfico!")
  }
```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}
kableExtra::kable(tabela_acoes, digits = 2, format = "markdown", align = 'lcccccccccccc')
```











\newpage
# Outros Investimentos
```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}
# ----------------------------------------- * Cod Tabela 5 * -------------------------------------------------
tabela_moedas_imoveis <- bind_rows(moedas, imoveis)


setor_tab2 <- c("Moedas/Depósitos", "Imóveis")


tabela_moedas_imoveis <- criar_tabela(tabela_moedas_imoveis, setor_tab2)
```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE, out.width = "100%"}
# ----------------------------------------- * Grafico 5 * -------------------------------------------------
  tab_grafico5 <- tabela_moedas_imoveis
  
  tab_grafico5 <- tab_grafico5 %>% 
    select(names,"2010","2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020")%>%
    pivot_longer(cols = "2010":"2020", names_to = "anos", values_to = "valores") 
  #------------------------------------------------------------------------------------------------------------------  
  
  a <- tab_grafico5 %>%
    filter("Moedas/Depósitos" == names)
  
  b <- tab_grafico5 %>%
    filter("Imóveis" == names)
  #------------------------------------------------------------------------------------------------------------------ 
  
  if(a$valores > 0 || b$valores > 0){
    ggplot(a, aes(x = anos, y = valores ),
           b, aes(x = anos, y = valores )) +
      geom_bar(stat = "identity", aes(y = a$valores, fill = "Moedas/Depósitos" ), position = position_nudge(x = -.15), width = .3)+
      geom_bar(stat = "identity", aes(y = b$valores, fill = "Imóveis"  ), position = position_nudge(x = .15), width = .3) +
      scale_y_continuous("US$ milhões")+
      scale_x_yearmon(NULL, format = "%Y", breaks = seq(2010,2020))+
      scale_fill_manual(NULL, values = saturation(c("#B22222","#5b80ab"), scalefac(0.8)))+
      theme_classic ()+
      theme(panel.grid = element_blank(), # remove as linhas do corpo do gráfico
            # sem bordas entre os painéis
            panel.spacing = unit(0, "cm"),
            # modifica o texto dos eixos
            axis.text = element_text(size = 12, colour = "black"),
            # cor dos marcadores
            axis.ticks = element_line(colour = "black"),
            # tamanho dos marcadores
            axis.ticks.length = unit(.2, "cm"), 
            #cor da borda
            panel.border = element_rect(colour = "black", fill = NA, size = 0.5),
            axis.text.x = element_text(angle = 0, hjust = 0.5),
            legend.position="bottom", legend.box = "vertical") 
  }else{
    print("Sem dados suficiente para gerar o gráfico")
  }
```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}
  kableExtra::kable(tabela_moedas_imoveis, digits = 2, format = "markdown", align = 'lcccccccccccc')
```











\newpage
# IBD - Setor de Atividade Econômica (2020 - US$ milhões)
```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}

IBD_Por_Setor <- read_xlsx("data-raw/TabelasCompletasPosicaoIDE.xlsx",sheet = "18", range = "A5:BZ24")

if(pais %in% lista_paises_IBD_por_setor){
IBD_Por_Setor <- setores_idb(IBD_Por_Setor)
IBD_Por_Setor <- setores_final(IBD_Por_Setor, TESTE)

IBD_Por_Setor_Outros <- outros_func(IBD_Por_Setor, Invest_Imediato_IDE)
IBD_Por_Setor[nrow(IBD_Por_Setor) + 1,] <- IBD_Por_Setor_Outros


IBD_Por_Setor$Setores <- c("Atividades Imobiliárias", "Comércio, Reparação de Veículos Automotores e Motocicleta",
                           "Atividades Financeiras, de Seguros e Serviços Relacionad", "Indústrias de Transformação",
                           "Atividades Administrativas e Serviços Complementares", "Outros")
}else{
  print("Sem dados suficientes para gerar o gráfico!")
}

#-------------------------------------------------------------------------------------------------------------------------------

IBD_Qtd_Invest <- ler_excel("data-raw/TabelasCompletasPosicaoIDE.xlsx", "4", 4)

IBD_Qtd_Invest <- rename(IBD_Qtd_Invest, "2020" = "20202/")
anos15e20 <- c("2015","2020")
IBD_Qtd_Invest <- IDP_Qtd_Invest(IBD_Qtd_Invest,anos15e20)
IBD_Qtd_Invest <- soma_Qtd_Invest(IBD_Qtd_Invest,3,anos15e20)
IBD_Qtd_Invest$Setor <- c("IBD - Quantidade de Investidores")


IBD_Qtd_Invest <-  select(IBD_Qtd_Invest, Setor, "2015", "2020")
```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE, out.width = "100%"}
# ----------------------------------------- * Grafico 6 * -------------------------------------------------
if(pais %in% lista_paises_IBD_por_setor){
  tab_grafico6 <- IBD_Por_Setor

  # Realiza a soma do controle final
  total_IBD_Por_Setor <- tab_grafico6 %>%
    filter(tab_grafico6$Valores == max(tab_grafico6$Valores)) %>%
    select(-grep("Valores", colnames(tab_grafico6))) %>%
    summarise(var = colSums(tab_grafico6[2]))
  #------------------------------------------------------------------------------------------------------------------

  # Separa a coluna controle final
  coluna_valores_IBD_Por_Setor <- tab_grafico6 %>%
    select(Valores)
  #------------------------------------------------------------------------------------------------------------------

  # Calculo do porcentagem final
  tab_grafico6_porcentagem = coluna_valores_IBD_Por_Setor * 100 / total_IBD_Por_Setor$var
  #------------------------------------------------------------------------------------------------------------------

  # Add a porcentagem na tabela
  tab_grafico6$porcentagem <-  tab_grafico6_porcentagem$Valores
  #------------------------------------------------------------------------------------------------------------------
  
  #Filtra somente dados maiores que 0 para gerar o grafico
   tab_grafico6 <- tab_grafico6 %>% filter(porcentagem >= 0.01)
  #------------------------------------------------------------------------------------------------------------------
  
    ggplot(tab_grafico6, aes(x="", y = porcentagem, fill= Setores), label = value)+
      geom_bar(stat = "identity")+
      coord_polar(theta = "y", start = 0)+
      theme_void()+
      geom_label_repel(label = paste(round(tab_grafico6$porcentagem,2),"%"),
                       show.legend = F,
                       size = 5,
                       position =  position_stack(vjust = 0.5))
}
```


```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}
  if(pais %in% lista_paises_IBD_por_setor){
    kableExtra::kable(IBD_Por_Setor, format = "markdown", digits = 2)
  }
```

                  IBD - Quantidade de Investidores (>= 10% capital acionário)
```{r, echo=FALSE,fig.width=10, fig.height=5.8, message=FALSE,warning = FALSE}
  
    kableExtra::kable(IBD_Qtd_Invest, digits = 2, format = "markdown", align = 'lcc')
```

